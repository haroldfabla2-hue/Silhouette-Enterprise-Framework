<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Auto-Scale - Silhouette Enterprise Framework</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    <style>
        /* Reset y configuraci√≥n base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f7fa;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .dashboard-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-title h1 {
            font-size: 2.5rem;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header-title p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .header-status {
            text-align: right;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-dot.online {
            background: #28a745;
        }

        .status-dot.offline {
            background: #dc3545;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .status-text {
            font-weight: 600;
        }

        .last-update {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Control Panel */
        .control-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .control-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .control-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
        }

        .control-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 10px 20px;
            border: 2px solid #667eea;
            background: transparent;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .control-btn.active {
            background: #667eea;
            color: white;
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            border-color: #ccc;
            color: #ccc;
        }

        .control-btn:disabled:hover {
            background: transparent;
            color: #ccc;
            transform: none;
        }

        .tier-selector {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }

        .tier-btn {
            padding: 8px 16px;
            border: 2px solid #e2e8f0;
            background: white;
            color: #64748b;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .tier-btn:hover {
            border-color: #667eea;
            color: #667eea;
        }

        .tier-btn.active {
            background: #667eea;
            border-color: #667eea;
            color: white;
        }

        .tier-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-5px);
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .metric-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .metric-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
        }

        .metric-icon.tokens {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .metric-icon.requests {
            background: linear-gradient(135deg, #28a745, #20c997);
        }

        .metric-icon.errors {
            background: linear-gradient(135deg, #dc3545, #fd7e14);
        }

        .metric-icon.response {
            background: linear-gradient(135deg, #ffc107, #fd7e14);
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 800;
            color: #1e293b;
            margin-bottom: 5px;
        }

        .metric-change {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .metric-change.positive {
            color: #28a745;
        }

        .metric-change.negative {
            color: #dc3545;
        }

        .metric-change.neutral {
            color: #64748b;
        }

        .metric-progress {
            margin-top: 15px;
        }

        .progress-bar {
            background: #e2e8f0;
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            background: linear-gradient(90deg, #667eea, #764ba2);
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
            position: relative;
        }

        .progress-fill.warning {
            background: linear-gradient(90deg, #ffc107, #fd7e14);
        }

        .progress-fill.danger {
            background: linear-gradient(90deg, #dc3545, #fd7e14);
        }

        .progress-text {
            font-size: 0.8rem;
            color: #64748b;
            margin-top: 5px;
            text-align: right;
        }

        /* Charts Section */
        .charts-section {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
        }

        .chart-timeframe {
            display: flex;
            gap: 5px;
        }

        .timeframe-btn {
            padding: 6px 12px;
            border: 1px solid #e2e8f0;
            background: white;
            color: #64748b;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .timeframe-btn:hover {
            border-color: #667eea;
            color: #667eea;
        }

        .timeframe-btn.active {
            background: #667eea;
            border-color: #667eea;
            color: white;
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
        }

        .chart-wrapper.small {
            height: 250px;
        }

        /* History Section */
        .history-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .history-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
        }

        .history-clear {
            padding: 8px 16px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            color: #6c757d;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .history-clear:hover {
            background: #e9ecef;
            color: #495057;
        }

        .history-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #f1f3f4;
            transition: background-color 0.3s ease;
        }

        .history-item:hover {
            background: #f8f9fa;
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .history-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            color: white;
        }

        .history-icon.scaling-up {
            background: linear-gradient(135deg, #28a745, #20c997);
        }

        .history-icon.scaling-down {
            background: linear-gradient(135deg, #dc3545, #fd7e14);
        }

        .history-icon.mode-change {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .history-details h4 {
            font-size: 1rem;
            color: #333;
            margin-bottom: 2px;
        }

        .history-details p {
            font-size: 0.85rem;
            color: #64748b;
        }

        .history-time {
            font-size: 0.8rem;
            color: #64748b;
            text-align: right;
        }

        /* Alerts Section */
        .alerts-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }

        .alerts-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .alerts-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
        }

        .alerts-toggle {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 25px;
            background: #ccc;
            border-radius: 25px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .toggle-switch.active {
            background: #667eea;
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 21px;
            height: 21px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(25px);
        }

        .alert-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            border-left: 4px solid;
        }

        .alert-item.warning {
            background: #fff3cd;
            border-left-color: #ffc107;
        }

        .alert-item.error {
            background: #f8d7da;
            border-left-color: #dc3545;
        }

        .alert-item.info {
            background: #d1ecf1;
            border-left-color: #17a2b8;
        }

        .alert-icon {
            font-size: 1.2rem;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 600;
            margin-bottom: 2px;
        }

        .alert-message {
            font-size: 0.9rem;
            color: #666;
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            max-width: 350px;
            z-index: 1000;
            transform: translateX(400px);
            transition: all 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left: 5px solid #28a745;
        }

        .notification.error {
            border-left: 5px solid #dc3545;
        }

        .notification.warning {
            border-left: 5px solid #ffc107;
        }

        .notification.info {
            border-left: 5px solid #17a2b8;
        }

        .notification-header {
            font-weight: 600;
            margin-bottom: 8px;
        }

        .notification-message {
            color: #666;
            font-size: 0.9rem;
        }

        /* Loading States */
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            border: 2px solid #667eea;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            transform: translate(-50%, -50%);
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .charts-section {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header-content {
                flex-direction: column;
                text-align: center;
            }

            .header-title h1 {
                font-size: 2rem;
            }

            .control-header {
                flex-direction: column;
                align-items: stretch;
            }

            .control-buttons {
                justify-content: center;
            }

            .tier-selector {
                justify-content: center;
            }

            .metrics-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }

            .notification {
                max-width: calc(100vw - 40px);
                right: 10px;
                left: 10px;
                transform: translateY(-100px);
            }

            .notification.show {
                transform: translateY(0);
            }
        }

        @media (max-width: 480px) {
            .metric-card {
                padding: 15px;
            }

            .metric-value {
                font-size: 1.5rem;
            }

            .chart-container {
                padding: 15px;
            }

            .chart-wrapper {
                height: 250px;
            }

            .history-item {
                padding: 10px;
            }

            .history-info {
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Dashboard Header -->
        <div class="dashboard-header">
            <div class="header-content">
                <div class="header-title">
                    <h1>üìä Dashboard Auto-Scale</h1>
                    <p>Monitoreo en Tiempo Real - Silhouette Enterprise Framework V4.0</p>
                </div>
                <div class="header-status">
                    <div class="status-indicator">
                        <div class="status-dot online" id="statusDot"></div>
                        <span class="status-text" id="statusText">Sistema Activo</span>
                    </div>
                    <div class="last-update" id="lastUpdate">√öltima actualizaci√≥n: hace 0s</div>
                </div>
            </div>
        </div>

        <!-- Control Panel -->
        <div class="control-panel">
            <div class="control-header">
                <h2 class="control-title">üéõÔ∏è Panel de Control</h2>
                <div class="control-buttons">
                    <button class="control-btn active" id="manualBtn" onclick="setScalingMode('manual')">
                        üìä Modo Manual
                    </button>
                    <button class="control-btn" id="autoBtn" onclick="setScalingMode('auto')">
                        ‚ö° Modo Autom√°tico
                    </button>
                    <div class="tier-selector">
                        <span style="color: #64748b; font-weight: 500;">Tier Manual:</span>
                        <button class="tier-btn" data-tier="free" onclick="selectManualTier('free')">Free</button>
                        <button class="tier-btn" data-tier="pyme" onclick="selectManualTier('pyme')">PYME</button>
                        <button class="tier-btn" data-tier="mediana" onclick="selectManualTier('mediana')">Mediana</button>
                        <button class="tier-btn" data-tier="enterprise" onclick="selectManualTier('enterprise')">Enterprise</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Metrics Grid -->
        <div class="metrics-grid">
            <!-- Tokens Usage -->
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-title">Uso de Tokens</div>
                    <div class="metric-icon tokens">üî¢</div>
                </div>
                <div class="metric-value" id="tokensValue">0</div>
                <div class="metric-change positive" id="tokensChange">
                    <span>‚ÜóÔ∏è +0%</span>
                    <span>vs anterior</span>
                </div>
                <div class="metric-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="tokensProgress" style="width: 0%"></div>
                    </div>
                    <div class="progress-text" id="tokensProgressText">0 / 10,000</div>
                </div>
            </div>

            <!-- Requests -->
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-title">Solicitudes</div>
                    <div class="metric-icon requests">üìä</div>
                </div>
                <div class="metric-value" id="requestsValue">0</div>
                <div class="metric-change neutral" id="requestsChange">
                    <span>‚û°Ô∏è +0%</span>
                    <span>vs anterior</span>
                </div>
                <div class="metric-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="requestsProgress" style="width: 0%"></div>
                    </div>
                    <div class="progress-text" id="requestsProgressText">0 hoy</div>
                </div>
            </div>

            <!-- Error Rate -->
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-title">Tasa de Errores</div>
                    <div class="metric-icon errors">‚ö†Ô∏è</div>
                </div>
                <div class="metric-value" id="errorsValue">0%</div>
                <div class="metric-change neutral" id="errorsChange">
                    <span>‚û°Ô∏è +0%</span>
                    <span>vs anterior</span>
                </div>
                <div class="metric-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="errorsProgress" style="width: 0%"></div>
                    </div>
                    <div class="progress-text" id="errorsProgressText">0 errores</div>
                </div>
            </div>

            <!-- Response Time -->
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-title">Tiempo Respuesta</div>
                    <div class="metric-icon response">‚è±Ô∏è</div>
                </div>
                <div class="metric-value" id="responseValue">0ms</div>
                <div class="metric-change neutral" id="responseChange">
                    <span>‚û°Ô∏è +0ms</span>
                    <span>vs anterior</span>
                </div>
                <div class="metric-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="responseProgress" style="width: 0%"></div>
                    </div>
                    <div class="progress-text" id="responseProgressText">Promedio 0ms</div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-section">
            <!-- Usage Chart -->
            <div class="chart-container">
                <div class="chart-header">
                    <h3 class="chart-title">üìà Uso de Tokens en Tiempo Real</h3>
                    <div class="chart-timeframe">
                        <button class="timeframe-btn active" onclick="setTimeframe('1h')">1H</button>
                        <button class="timeframe-btn" onclick="setTimeframe('6h')">6H</button>
                        <button class="timeframe-btn" onclick="setTimeframe('24h')">24H</button>
                        <button class="timeframe-btn" onclick="setTimeframe('7d')">7D</button>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="usageChart"></canvas>
                </div>
            </div>

            <!-- Tier Distribution -->
            <div class="chart-container">
                <div class="chart-header">
                    <h3 class="chart-title">üéØ Distribuci√≥n de Tiers</h3>
                </div>
                <div class="chart-wrapper small">
                    <canvas id="tierChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Scaling History -->
        <div class="history-section">
            <div class="history-header">
                <h3 class="history-title">üìú Historial de Escalado</h3>
                <button class="history-clear" onclick="clearHistory()">Limpiar</button>
            </div>
            <div class="history-list" id="historyList">
                <!-- History items will be populated by JavaScript -->
            </div>
        </div>

        <!-- Alerts Section -->
        <div class="alerts-section">
            <div class="alerts-header">
                <h3 class="alerts-title">üö® Alertas del Sistema</h3>
                <div class="alerts-toggle">
                    <span style="color: #64748b; font-weight: 500;">Notificaciones:</span>
                    <div class="toggle-switch active" id="alertsToggle" onclick="toggleAlerts()">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
            </div>
            <div class="alerts-list" id="alertsList">
                <div class="alert-item info">
                    <div class="alert-icon">‚ÑπÔ∏è</div>
                    <div class="alert-content">
                        <div class="alert-title">Sistema Operativo</div>
                        <div class="alert-message">Todos los servicios funcionan correctamente</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div style="text-align: center; padding: 40px 20px; color: #64748b;">
            <p>¬© 2025 Silhouette Enterprise Framework V4.0 - Desarrollado por MiniMax Agent</p>
        </div>
    </div>

    <!-- Notification Container -->
    <div class="notification" id="notification">
        <div class="notification-header" id="notificationHeader"></div>
        <div class="notification-message" id="notificationMessage"></div>
    </div>

    <script>
        // Global variables
        let currentMode = 'auto';
        let currentTier = 'free';
        let currentTimeframe = '1h';
        let alertsEnabled = true;
        let usageChart = null;
        let tierChart = null;
        let updateInterval = null;

        // Framework state
        let frameworkState = {
            tokens: 0,
            maxTokens: 10000,
            requests: 0,
            errors: 0,
            errorRate: 0,
            responseTime: 0,
            history: []
        };

        // Initialize dashboard
        function initializeDashboard() {
            console.log('üöÄ Initializing Silhouette Auto-Scale Dashboard...');

            // Initialize charts
            initializeCharts();

            // Set up event handlers
            setupEventHandlers();

            // Start real-time updates
            startRealTimeUpdates();

            // Load initial data
            loadInitialData();

            console.log('‚úÖ Dashboard initialized successfully');
        }

        // Initialize charts
        function initializeCharts() {
            // Usage Chart
            const usageCtx = document.getElementById('usageChart').getContext('2d');
            usageChart = new Chart(usageCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Tokens Utilizados',
                        data: [],
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'L√≠mite de Tokens',
                        data: [],
                        borderColor: '#dc3545',
                        backgroundColor: 'rgba(220, 53, 69, 0.1)',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Tiempo'
                            }
                        },
                        y: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Tokens'
                            },
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });

            // Tier Distribution Chart
            const tierCtx = document.getElementById('tierChart').getContext('2d');
            tierChart = new Chart(tierCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Free', 'PYME', 'Mediana', 'Enterprise'],
                    datasets: [{
                        data: [1, 0, 0, 0],
                        backgroundColor: [
                            '#28a745',
                            '#ffc107',
                            '#fd7e14',
                            '#667eea'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Set up event handlers
        function setupEventHandlers() {
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey || e.metaKey) {
                    switch (e.key) {
                        case 'm':
                            e.preventDefault();
                            setScalingMode('manual');
                            break;
                        case 'a':
                            e.preventDefault();
                            setScalingMode('auto');
                            break;
                    }
                }
            });

            // Handle visibility change (pause updates when tab is not visible)
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    stopRealTimeUpdates();
                } else {
                    startRealTimeUpdates();
                }
            });
        }

        // Set scaling mode (manual or auto)
        async function setScalingMode(mode) {
            if (mode === currentMode) {
                return;
            }

            try {
                // Disable buttons during operation
                document.querySelectorAll('.control-btn').forEach(btn => btn.disabled = true);

                // Update current mode
                const oldMode = currentMode;
                currentMode = mode;

                // Update UI
                updateModeUI(mode);

                // Simulate API call to framework controller
                await new Promise(resolve => setTimeout(resolve, 1000));

                // Add to history
                addToHistory('mode-change', `Modo cambiado: ${oldMode} ‚Üí ${mode}`, mode);

                showNotification('success', 'Modo Cambiado', `Modo ${mode === 'manual' ? 'Manual' : 'Autom√°tico'} activado`);

                console.log(`üîÑ Scaling mode changed: ${oldMode} ‚Üí ${mode}`);

            } catch (error) {
                console.error('‚ùå Mode change failed:', error);
                showNotification('error', 'Error de Modo', 'No se pudo cambiar el modo de operaci√≥n');
            } finally {
                // Re-enable buttons
                document.querySelectorAll('.control-btn').forEach(btn => btn.disabled = false);
            }
        }

        // Update mode UI
        function updateModeUI(mode) {
            // Update button states
            const manualBtn = document.getElementById('manualBtn');
            const autoBtn = document.getElementById('autoBtn');
            const tierBtns = document.querySelectorAll('.tier-btn');

            // Reset button classes
            manualBtn.classList.remove('active');
            autoBtn.classList.remove('active');

            // Set active button
            if (mode === 'manual') {
                manualBtn.classList.add('active');
            } else {
                autoBtn.classList.add('active');
            }

            // Enable/disable tier selector
            tierBtns.forEach(btn => {
                btn.disabled = mode !== 'manual';
                if (mode !== 'manual') {
                    btn.classList.remove('active');
                }
            });

            // Update tier selector display
            updateTierSelectorUI();
        }

        // Select manual tier
        async function selectManualTier(tierName) {
            if (currentMode !== 'manual') {
                showNotification('warning', 'Modo Incorrecto', 'La selecci√≥n manual solo est√° disponible en modo manual');
                return;
            }

            if (tierName === currentTier) {
                showNotification('info', 'Tier Actual', `Ya est√°s usando el tier ${tierName}`);
                return;
            }

            try {
                // Disable tier buttons during operation
                document.querySelectorAll('.tier-btn').forEach(btn => btn.disabled = true);

                // Update current tier
                const oldTier = currentTier;
                currentTier = tierName;

                // Update UI
                updateTierSelectorUI();

                // Simulate API call to framework controller
                await new Promise(resolve => setTimeout(resolve, 1500));

                // Add to history
                addToHistory('tier-change', `Tier manual: ${oldTier} ‚Üí ${tierName}`, tierName);

                showNotification('success', 'Tier Cambiado', `${oldTier} ‚Üí ${tierName} (Modo Manual)`);

                console.log(`üéØ Manual tier selection: ${oldTier} ‚Üí ${tierName}`);

            } catch (error) {
                console.error('‚ùå Tier selection failed:', error);
                showNotification('error', 'Error de Selecci√≥n', 'No se pudo cambiar el tier');
            } finally {
                // Re-enable tier buttons
                document.querySelectorAll('.tier-btn').forEach(btn => btn.disabled = currentMode !== 'manual');
            }
        }

        // Update tier selector UI
        function updateTierSelectorUI() {
            const tierBtns = document.querySelectorAll('.tier-btn');
            
            tierBtns.forEach(btn => {
                const tier = btn.getAttribute('data-tier');
                if (tier === currentTier && currentMode === 'manual') {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        // Set timeframe for charts
        function setTimeframe(timeframe) {
            if (timeframe === currentTimeframe) {
                return;
            }

            currentTimeframe = timeframe;

            // Update UI
            document.querySelectorAll('.timeframe-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Refresh chart data
            refreshChartData();

            console.log(`üìä Timeframe changed to: ${timeframe}`);
        }

        // Toggle alerts
        function toggleAlerts() {
            alertsEnabled = !alertsEnabled;
            const toggle = document.getElementById('alertsToggle');
            
            if (alertsEnabled) {
                toggle.classList.add('active');
            } else {
                toggle.classList.remove('active');
            }

            console.log(`üö® Alerts ${alertsEnabled ? 'enabled' : 'disabled'}`);
        }

        // Start real-time updates
        function startRealTimeUpdates() {
            if (updateInterval) {
                clearInterval(updateInterval);
            }

            updateInterval = setInterval(async () => {
                try {
                    await updateMetrics();
                    updateUI();
                } catch (error) {
                    console.error('‚ùå Update failed:', error);
                }
            }, 3000); // Update every 3 seconds
        }

        // Stop real-time updates
        function stopRealTimeUpdates() {
            if (updateInterval) {
                clearInterval(updateInterval);
                updateInterval = null;
            }
        }

        // Load initial data
        async function loadInitialData() {
            try {
                // Initialize with sample data
                frameworkState = {
                    tokens: Math.floor(Math.random() * 5000) + 1000,
                    maxTokens: 10000,
                    requests: Math.floor(Math.random() * 500) + 100,
                    errors: Math.floor(Math.random() * 10),
                    errorRate: 0,
                    responseTime: Math.floor(Math.random() * 2000) + 500,
                    history: []
                };

                // Calculate error rate
                frameworkState.errorRate = frameworkState.errors / frameworkState.requests * 100;

                // Initialize chart data
                initializeChartData();

                // Update UI
                updateUI();

                console.log('‚úÖ Initial data loaded');
            } catch (error) {
                console.error('‚ùå Failed to load initial data:', error);
            }
        }

        // Initialize chart data
        function initializeChartData() {
            const labels = [];
            const tokensData = [];
            const limitData = [];
            const now = new Date();

            // Generate initial data points
            for (let i = 23; i >= 0; i--) {
                const time = new Date(now.getTime() - i * 60 * 60 * 1000);
                labels.push(time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }));
                tokensData.push(Math.floor(Math.random() * 5000) + 1000);
                limitData.push(10000);
            }

            usageChart.data.labels = labels;
            usageChart.data.datasets[0].data = tokensData;
            usageChart.data.datasets[1].data = limitData;
            usageChart.update();
        }

        // Update metrics (simulated)
        async function updateMetrics() {
            // Simulate random changes in metrics
            const changeTokens = Math.floor(Math.random() * 200) - 100;
            const changeRequests = Math.floor(Math.random() * 50) - 25;
            const changeErrors = Math.floor(Math.random() * 3) - 1;
            const changeResponse = Math.floor(Math.random() * 500) - 250;

            frameworkState.tokens = Math.max(0, Math.min(frameworkState.maxTokens, frameworkState.tokens + changeTokens));
            frameworkState.requests = Math.max(0, frameworkState.requests + changeRequests);
            frameworkState.errors = Math.max(0, frameworkState.errors + changeErrors);
            frameworkState.responseTime = Math.max(100, frameworkState.responseTime + changeResponse);
            frameworkState.errorRate = frameworkState.errors / Math.max(frameworkState.requests, 1) * 100;

            // Check for scaling thresholds
            checkScalingThresholds();
        }

        // Check scaling thresholds
        function checkScalingThresholds() {
            const tokenPercent = frameworkState.tokens / frameworkState.maxTokens * 100;
            const errorRatePercent = frameworkState.errorRate;

            if (currentMode === 'auto') {
                // Check if scaling is needed
                if (tokenPercent >= 80 && currentTier !== 'enterprise') {
                    if (alertsEnabled) {
                        addAlert('warning', 'Escalado Autom√°tico', `Alto uso de tokens (${tokenPercent.toFixed(1)}%). Escalando autom√°ticamente...`);
                    }
                    
                    // Simulate auto-scaling
                    setTimeout(() => {
                        const nextTier = getNextTier(currentTier);
                        if (nextTier) {
                            currentTier = nextTier;
                            frameworkState.maxTokens = getTierConfig(nextTier).maxTokens;
                            addToHistory('auto-scale', `Escalado autom√°tico: ${currentTier}`, currentTier);
                            showNotification('info', 'Escalado Autom√°tico', `Tier actualizado a ${currentTier}`);
                            updateTierSelectorUI();
                        }
                    }, 2000);
                }
            }

            // Add threshold alerts
            if (tokenPercent >= 90) {
                addAlert('error', 'L√≠mite de Tokens', `Uso cr√≠tico: ${tokenPercent.toFixed(1)}% del l√≠mite alcanzado`);
            } else if (tokenPercent >= 80) {
                addAlert('warning', 'Alto Uso', `Uso elevado: ${tokenPercent.toFixed(1)}% del l√≠mite`);
            }

            if (errorRatePercent >= 5) {
                addAlert('error', 'Alta Tasa de Errores', `Error rate: ${errorRatePercent.toFixed(1)}%`);
            }
        }

        // Get next tier
        function getNextTier(current) {
            const tierOrder = ['free', 'pyme', 'mediana', 'enterprise'];
            const currentIndex = tierOrder.indexOf(current);
            return currentIndex < tierOrder.length - 1 ? tierOrder[currentIndex + 1] : null;
        }

        // Get tier configuration
        function getTierConfig(tier) {
            const configs = {
                free: { maxTokens: 10000, cost: 0 },
                pyme: { maxTokens: 100000, cost: 250 },
                mediana: { maxTokens: 500000, cost: 1200 },
                enterprise: { maxTokens: 2000000, cost: 3500 }
            };
            return configs[tier] || configs.free;
        }

        // Update UI
        function updateUI() {
            updateMetricsDisplay();
            updateChartData();
            updateLastUpdateTime();
        }

        // Update metrics display
        function updateMetricsDisplay() {
            // Tokens
            document.getElementById('tokensValue').textContent = frameworkState.tokens.toLocaleString();
            const tokenPercent = frameworkState.tokens / frameworkState.maxTokens * 100;
            const progressFill = document.getElementById('tokensProgress');
            const progressText = document.getElementById('tokensProgressText');
            
            progressFill.style.width = `${tokenPercent}%`;
            progressText.textContent = `${frameworkState.tokens.toLocaleString()} / ${frameworkState.maxTokens.toLocaleString()}`;
            
            if (tokenPercent >= 90) {
                progressFill.className = 'progress-fill danger';
            } else if (tokenPercent >= 80) {
                progressFill.className = 'progress-fill warning';
            } else {
                progressFill.className = 'progress-fill';
            }

            // Requests
            document.getElementById('requestsValue').textContent = frameworkState.requests.toLocaleString();
            document.getElementById('requestsProgressText').textContent = `${frameworkState.requests.toLocaleString()} hoy`;

            // Error Rate
            document.getElementById('errorsValue').textContent = `${frameworkState.errorRate.toFixed(1)}%`;
            document.getElementById('errorsProgressText').textContent = `${frameworkState.errors} errores`;

            // Response Time
            document.getElementById('responseValue').textContent = `${frameworkState.responseTime}ms`;
            document.getElementById('responseProgressText').textContent = `Promedio ${frameworkState.responseTime}ms`;
        }

        // Update chart data
        function updateChartData() {
            const now = new Date();
            const timeLabel = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

            // Add new data point
            usageChart.data.labels.push(timeLabel);
            usageChart.data.datasets[0].data.push(frameworkState.tokens);
            usageChart.data.datasets[1].data.push(frameworkState.maxTokens);

            // Keep only last 24 points
            if (usageChart.data.labels.length > 24) {
                usageChart.data.labels.shift();
                usageChart.data.datasets[0].data.shift();
                usageChart.data.datasets[1].data.shift();
            }

            usageChart.update('none');

            // Update tier chart
            const tierData = [0, 0, 0, 0];
            tierData[['free', 'pyme', 'mediana', 'enterprise'].indexOf(currentTier)] = 1;
            tierChart.data.datasets[0].data = tierData;
            tierChart.update('none');
        }

        // Update last update time
        function updateLastUpdateTime() {
            const now = new Date();
            document.getElementById('lastUpdate').textContent = `√öltima actualizaci√≥n: ${now.toLocaleTimeString()}`;
        }

        // Add to history
        function addToHistory(type, description, tier) {
            const historyItem = {
                type,
                description,
                tier,
                timestamp: new Date()
            };

            frameworkState.history.unshift(historyItem);

            // Keep only last 50 items
            if (frameworkState.history.length > 50) {
                frameworkState.history = frameworkState.history.slice(0, 50);
            }

            updateHistoryDisplay();
        }

        // Update history display
        function updateHistoryDisplay() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';

            frameworkState.history.forEach(item => {
                const historyElement = document.createElement('div');
                historyElement.className = 'history-item';
                
                const iconClass = {
                    'mode-change': 'mode-change',
                    'tier-change': 'scaling-up',
                    'auto-scale': 'scaling-up'
                }[item.type] || 'mode-change';

                historyElement.innerHTML = `
                    <div class="history-info">
                        <div class="history-icon ${iconClass}">
                            ${getHistoryIcon(item.type)}
                        </div>
                        <div class="history-details">
                            <h4>${item.description}</h4>
                            <p>Tier: ${item.tier} ‚Ä¢ ${item.timestamp.toLocaleString()}</p>
                        </div>
                    </div>
                `;

                historyList.appendChild(historyElement);
            });
        }

        // Get history icon
        function getHistoryIcon(type) {
            const icons = {
                'mode-change': 'üîÑ',
                'tier-change': 'üéØ',
                'auto-scale': '‚ö°'
            };
            return icons[type] || 'üìä';
        }

        // Clear history
        function clearHistory() {
            frameworkState.history = [];
            updateHistoryDisplay();
            showNotification('info', 'Historial Limpiado', 'El historial de escalado ha sido limpiado');
        }

        // Add alert
        function addAlert(type, title, message) {
            if (!alertsEnabled) return;

            const alertsList = document.getElementById('alertsList');
            const alertElement = document.createElement('div');
            alertElement.className = `alert-item ${type}`;
            
            alertElement.innerHTML = `
                <div class="alert-icon">${getAlertIcon(type)}</div>
                <div class="alert-content">
                    <div class="alert-title">${title}</div>
                    <div class="alert-message">${message}</div>
                </div>
            `;

            // Add to top of list
            alertsList.insertBefore(alertElement, alertsList.firstChild);

            // Remove alerts older than 10
            const alerts = alertsList.querySelectorAll('.alert-item');
            if (alerts.length > 10) {
                alertsList.removeChild(alerts[alerts.length - 1]);
            }

            // Auto-remove after 30 seconds
            setTimeout(() => {
                if (alertElement.parentNode) {
                    alertElement.remove();
                }
            }, 30000);
        }

        // Get alert icon
        function getAlertIcon(type) {
            const icons = {
                'warning': '‚ö†Ô∏è',
                'error': 'üö®',
                'info': '‚ÑπÔ∏è',
                'success': '‚úÖ'
            };
            return icons[type] || '‚ÑπÔ∏è';
        }

        // Show notification
        function showNotification(type, header, message) {
            const notification = document.getElementById('notification');
            const notificationHeader = document.getElementById('notificationHeader');
            const notificationMessage = document.getElementById('notificationMessage');

            // Set notification content
            notificationHeader.textContent = header;
            notificationMessage.textContent = message;

            // Set notification type
            notification.className = `notification ${type}`;

            // Show notification
            notification.classList.add('show');

            // Auto hide after 5 seconds
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        // Refresh chart data
        function refreshChartData() {
            // This would typically fetch new data based on the timeframe
            console.log(`üìä Refreshing chart data for timeframe: ${currentTimeframe}`);
            // Implementation would depend on actual API endpoints
        }

        // Initialize dashboard when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            initializeDashboard();

            // Add welcome notification
            setTimeout(() => {
                showNotification('info', 'Dashboard Activo', 'Sistema de monitoreo en tiempo real iniciado');
            }, 1000);
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            stopRealTimeUpdates();
        });

        // Export functions for testing
        if (typeof module !== 'undefined' && module.exports) {
            module.exports = {
                setScalingMode,
                selectManualTier,
                setTimeframe,
                toggleAlerts,
                clearHistory
            };
        }
    </script>
</body>
</html>
